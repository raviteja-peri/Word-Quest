guidelines for web content transformation proxies  guidelines for web content transformation proxies  wc working group note  october  this version httpwwwworgtrnotectguidelines latest version httpwwwworgtrctguidelines previous version httpwwwworgtrcrctguidelines editor jo rabin invited expert and before at mtld top level domain dotmobi copyright   wc mit ercim keio all rights reserved wc liability trademark and document use rules apply abstract this document provides guidance to content transformation proxies as to whether and how to transform web content content transformation proxies alter requests sent by user agents to servers and responses returned by servers so that the appearance structure or control flow of web applications are modified content transformation proxies are mostly used to convert web sites designed for desktop computers to a form suitable for mobile devices based on current practice and standards this document specifies mechanisms with which content transformation proxies should make their presence known to other parties present the outcome of alterations performed on http traffic and react to indications set by clients or servers to constrain these alterations the objective is to reduce undesirable effects on web applications especially mobileready ones and to limit the diversity in the modes of operation of content transformation proxies while at the same time allowing proxies to alter content that would otherwise not display successfully on mobile devices important considerations regarding the impact on security are highlighted status of this document this section describes the status of this document at the time of its publication other documents may supersede this document a list of current wc publications and the latest revision of this technical report can be found in the wc technical reports index at httpwwwworgtr this document was developed by the mobile web best practices working group as part of the mobile web initiative this document was expected to become a wc recommendation and was published as a wc candidate recommendation on  june  as of october  the mobile web best practices working group acknowledges the lack of existing implementations nevertheless it also believes that the guidelines establish a framework acceptable by all parties involved the mobile web best practices working group eventually resolved to discontinue the work on this document and to publish it as a working group note the working group hopes that this note may serve as a basis for discussion and negotiation among players other than changes to this section the document has not changed since its publication as a wc candidate recommendation in particular the use of normative language has been kept asis comments on this document may be sent to the working groups public email list publicbpwgcomments@worg with public archive the public publiccontenttransformationconformance@worg mailinglist with public archive that had been created to gather implementation feedback may still be used for that purpose the working group also invites people willing to contribute to the test case repository to let themselves known on the publicbpwgcomments@worg public mailinglist noting however that no further work is anticipated on that topic within the group as of october  please check the test case repository for uptodate information publication as a working group note does not imply endorsement by the wc membership this is a draft document and may be updated replaced or obsoleted by other documents at any time it is inappropriate to cite this document as other than work in progress this document was produced by a group operating under the  february  wc patent policy wc maintains a public list of any patent disclosures made in connection with the deliverables of the group that page also includes instructions for disclosing a patent an individual who has actual knowledge of a patent which the individual believes contains essential claims must disclose the information in accordance with section  of the wc patent policy table of contents  introduction nonnormative  purpose  audience  scope  principles  iab considerations  priority of intention  terminology normative  types of proxy  types of transformation  user interaction  conformance normative  classes of product  normative and informative parts  normative language for conformance requirements  transformation deployment conformance  behavior of components normative  proxy forwarding of request  applicable http methods  notransform directive in request  treatment of requesters that are not web browsers  serving cached responses  alteration of http header field values  content tasting  avoiding request unacceptable responses  user selection of restructured experience  sequence of requests  original header fields  additional http header fields  proxy treatment of via header field  proxy forwarding of response to user agent  user preferences  receipt of cachecontrol notransform  use of cachecontrol notransform  server rejection of http request  receipt of vary http header field  link to handheld representation  wml content  proxy decision to transform  alteration of response  link rewriting  https link rewriting  testing normative appendices a references b conformance statement c internet content types associated with mobile content d internet content types associated with data content e doctypes associated with mobile content f uri patterns associated with mobile web sites g summary of user preference handling h example transformation interactions nonnormative h basic content tasting by proxy h optimization based on previous server interaction h optimization based on previous server interaction server has changed its operation h server response indicating that this representation is intended for the target device h server response indicating that another representation is intended for the target device i informative guidance for origin servers nonnormative i server response to proxy i use of http  status i use of http  status i server origination of cachecontrol notransform i varying representations i use of vary http header field i indication of intended presentation media type of representation j applicability to transforming solutions which are out of scope nonnormative k scope for future work nonnormative k powder k link http header field k sources of device information k inter proxy communication k explicit consent k amendment to and refinement of http l acknowledgments nonnormative  introduction nonnormative  purpose within this document content transformation refers to the manipulation of requests to and responses from an origin server this manipulation is carried out by proxies in order to provide a better user experience of content that would otherwise result in an unsatisfactory experience on the device making the request the wc mobile web best practices working group neither approves nor disapproves of content transformation but recognizes that is being deployed widely across mobile data access networks the deployments are widely divergent to each other with many nonstandard http implications and no wellunderstood means either of identifying the presence of such transforming proxies nor of controlling their actions this document establishes a framework to allow that to happen the overall objective of this document is to provide a means as far as is practical for users to be provided with at least a functional user experience device independence glossary of the web when mobile taking into account the fact that an increasing number of content providers create experiences specially tailored to the mobile context which they do not wish to be altered by third parties equally it takes into account the fact that there remain a very large number of web sites that do not provide a functional user experience when perceived on many mobile devices it is stressed that this document is unlikely to be the last word on this topic as noted below  scope it is out of scope of this document to provide a comprehensive solution to control of transforming proxies though such a solution would appear to be needed the document is an attempt to improve a situation at a point in time where there appears to be disregard of the provisions of http  and is primarily a reminder and an encouragement to follow those provisions more closely  audience the audience for this document is creators of content transformation proxies and purchasers and operators of such proxies the document also contains nonnormative guidance for content providers whose services may be accessed by means of such proxies  scope the recommendations in this document refer only to web browsing  ie access by user agents that are intended primarily for interaction by users with html web pages web browsers using http clients that interact with proxies using mechanisms other than http and that typically involve the download of a special client are out of scope and are considered to be a distributed user agent proxies which are operated in the control of or under the direction of the operator of an origin server are similarly considered to be a distributed origin server and hence out of scope the wc mobile web best practices working group bpwg is not chartered to create new technology  its role is to advise on best practice for use of existing technology in satisfying content transformation requirements existing http header fields directives and behaviors must be respected and as far as is practical no extensions to rfc  http are to be used the recommendations in this document refer to interactions of a proxy and do not refer to any presumed aspects of the internal operation of the proxy for this reason the document does not discuss use of allow and disallow lists though it does discuss behavior that is induced by the implementation of such lists in addition it does not discuss details of how transformation is carried out except if this is reflected in interoperability for this reason it does not discuss the insertion or insertion of headers and footers or any other specific behaviors though it does discuss the need for essential user interaction of some form moral legal and other similar questions are not in scope of this document the bpwg does not have authority or expertise to comment one way or another about setting precedent or authorising any particular behavior or its absence  principles  iab considerations the bpwg made reference to internet architecture board iab work on open pluggable edge services rfc  opes for various principles that underlie behavior of proxies in this work the iab expressed its concerns about privacy control monitoring and accountability of such services  priority of intention the web allows users considerable flexibility in respect of the representation of content at the same time content providers may have a preferred manner in which they wish their content to be represented content transformation must reconcile these contrasting factors in creating this recommendation the bpwg has determined that content transformation proxies should respect content providers intentions where they are expressed but may allow users to choose other representations except where content providers specifically prohibit this the bpwg recognizes that there is neither a systematic vocabulary for content provider intentions nor a systematic means of expression of such intentions there is scope for further work in this area see k scope for future work  terminology normative  types of proxy alteration of http requests and responses is not prohibited by http other than in the circumstances referred to in rfc  http section  and section  http defines two types of proxy transparent proxies and nontransparent proxies as discussed in rfc  http section  terminology a transparent proxy is a proxy that does not modify the request or response beyond what is required for proxy authentication and identification a nontransparent proxy is a proxy that modifies the request or response in order to provide some added service to the user agent such as group annotation services media type transformation protocol reduction or anonymity filtering except where either transparent or nontransparent behavior is explicitly stated the http proxy requirements apply to both types of proxies this document elaborates the behavior of nontransparent proxies when used for content transformation in the context discussed in ct landscape  types of transformation transforming proxies can carry out a wide variety of operations in this document we categorize these operations as follows noting that these are general concepts that we do not formalize further alteration of requests transforming proxies process requests in a number of ways especially replacement of various request header fields to avoid http  status responses if a server can not provide content that is compatible with the original http request header fields and at user request alteration of responses there are three classes of operation on responses restructuring content restructuring content is a process whereby the original layout is altered so that content is added or removed or where the spatial or navigational relationship of parts of content is altered eg linearization ie reordering presentation elements especially tables so that they fit on a narrow display and can be traversed without horizontal scrolling or pagination ie splitting a document too large to be stored in or transmitted to the terminal in one piece so that it can be nevertheless accessed by browsing through a succession of smaller interlinked documents it also includes rewriting uris so that subsequent requests are routed via the proxy handling the response recoding content recoding content is a process whereby the layout of the content remains the same but details of its encoding may be altered examples include reencoding html as xhtml correcting invalid markup in html conversion of images between formats but not for example reducing animations to static images optimizing content optimizing content includes removing redundant white space recompressing images without loss of fidelity and compressing for transfer  user interaction at various points in this document there is reference to notifying the user informing the user  in general making the user aware that a situation exists or interacting with the user to solicit a choice of options the expectation is that such user interaction is conducted in a way that allows the user to perceive and interact with such information or choices in the same way as they interact with the web sites that they are visiting  conformance normative  classes of product the content transformation guidelines specification has one class of products transformation deployment a transformation deployment is the provision of nontransparent components in the path of http requests and responses provisions that are applicable to a transformation deployment are identified in this document by use of the term transforming proxy or proxy in the singular or plural  normative and informative parts normative parts of this document are identified by the use of normative following the section name informative parts are identified by use of nonnormative following the section name  normative language for conformance requirements the key words must must not required shall shall not should should not recommended not recommended may and optional in this recommendation have the meaning defined in rfc   transformation deployment conformance a transformation deployment conforms to these guidelines if it follows the statements in  transformation deployment conformance  proxy forwarding of request  proxy forwarding of response to user agent and  testing normative a transformation deployment that wishes to claim conformance must make available a conformance statement b conformance statement that specifies the reasons for noncompliance with any clauses containing the key words should and should not recommended and not recommended conformance statements must be sent to publiccontenttransformationconformance@worg public archive of this list may be found at httplistsworgarchivespublicpubliccontenttransformationconformance  behavior of components normative  proxy forwarding of request  applicable http methods user agents sometimes issue http head requests in order to determine if a resource is of a type andor size that they are capable of handling a transforming proxy may convert a head request into a get request in order to determine the characteristics of a transformed response that it would return if the user agent subsequently issued a get request for the same resource if the http method is altered from head to get proxies should providing such action is in accordance with normal http caching rules cache the response so that a second get request for the same content is not required see also  serving cached responses other than to convert between head and get proxies must not alter request methods  notransform directive in request if the request contains a cachecontrol notransform directive proxies must not alter the request other than to comply with transparent http behavior defined in rfc  http sections section  and section  and to add header fields as described in  additional http header fields below note an example of the use of cachecontrol notransform is the issuing of asynchronous http requests perhaps by means of xmlhttprequest xhr which may include such a directive in order to prevent transformation of both the request and the response  treatment of requesters that are not web browsers before altering aspects of http requests and responses proxies need to take account of the fact that http is used as a transport mechanism for many applications other than traditional browsing increasingly browser based applications involve exchanges of data using xmlhttprequest see  proxy decision to transform and alteration of such exchanges is likely to cause misoperation  serving cached responses aside from the usual caching procedures defined in rfc  http in some circumstances proxies may paginate responses and where this is the case a request may be for a subsequent page of a previously requested resource in this case proxies may for the sake of consistency of representation serve stale data but when doing so should notify the user that this is the case and must provide a simple means of retrieving a fresh copy  alteration of http header field values other than the modifications required by rfc  http proxies should not modify the values of header fields other than the useragent accept acceptcharset acceptencoding and acceptlanguage header fields and must not delete header fields see  original header fields other than to comply with transparent http operation proxies should not modify any request header fields unless one of the following applies the user would be prohibited from accessing content as a result of the server responding that the request is unacceptable see  server rejection of http request the user has specifically requested a restructured desktop experience see  user selection of restructured experience the request is part of a sequence of requests comprising either included resources or linked resources on the same web site see  sequence of requests these circumstances are detailed in the following sections note it is emphasized that requests must not be altered in the presence of cachecontrol notransform as described under  notransform directive in request note in this section the concept of web site is used rather than origin server as some origin servers host many different web sites since the concept of web site is not strictly defined proxies should use heuristics including comparisons of domain name to assess whether resources form part of the same web site note the uri referred to in the request plays no part in determining whether or not to alter http request header field values in particular the patterns mentioned in  proxy decision to transform are not material  content tasting while complying with this section  alteration of http header field values and section  receipt of vary http header field proxies should avoid making repeated requests for the same resource note while http does not prohibit repetition of get requests repeated requests place an unnecessary load on the network and server  avoiding request unacceptable responses a proxy may reissue a request with altered http header field values if a previous request with unaltered values resulted in the origin server rejecting the request as unacceptable see  server rejection of http request a proxy may apply heuristics of various kinds to assess in advance of sending unaltered header field values whether the request is likely to cause a request unacceptable response if it determines that this is likely then it may alter header field values without sending unaltered values in advance providing that it subsequently assesses the response as described under  receipt of vary http header field below and is prepared to reissue the request with unaltered header fields and alter its subsequent behavior in respect of the web site so that unaltered header fields are sent a proxy must not reissue a post request as it is unsafe see rfc  http section   user selection of restructured experience proxies must assume that by default users will wish to receive a representation prepared by the web site proxies may offer users an option to choose to view a restructured experience even when a web site offers a choice of user experience if a user has made such a choice then proxies may alter header field values when requesting resources in order to reflect that choice but must on receipt of an indication from a web site that it offers alternative representations see i indication of intended presentation media type of representation inform the user of that and allow them to select an alternative representation proxies must assess whether a users expressed preference for a restructured representation is still valid if a web site changes its choice of representations see  receipt of vary http header field  sequence of requests when requesting resources that are included resources eg style sheets images proxies should make the request for such resources with the same useragent header field as the request for the resource from which they are referenced for the purpose of consistency of representation proxies may request linked resources eg those referenced using the a element that form part of the same web site as a previously requested resource with the same header fields as the resource from which they are referenced when requesting linked resources that do not form part of the same web site as the resource from which they are linked proxies should not base their choice of header fields on a consistency of presentation premise  original header fields when forwarding an http request with altered http header fields in addition to complying with the rules of normal http operation proxies must include in the request additional fields of the form xdeviceoriginal header name whose values are verbatim copies of the corresponding unaltered header field values so that it is possible to reconstruct the original header fields for example if the useragent header field has been altered an xdeviceuseragent header field would be added with the value of the received useragent header field specifically the following mapping must be used original replacement ref useragent xdeviceuseragent rfc section  accept xdeviceaccept rfc section  acceptcharset xdeviceacceptcharset rfc section  acceptencoding xdeviceacceptencoding rfc section  acceptlanguage xdeviceacceptlanguage rfc section  note the xdevice prefixed header names listed in this section have been provisionally registered with iana see provisional message header field names note the xdevice prefix was chosen primarily on the basis that this is an already existing convention it is noted that the values encoded in such header fields may not ultimately derive from a device they are merely received fields the treatment of received xdevice header fields which may happen where there are multiple transforming proxies is undefined see k scope for future work  additional http header fields irrespective of the presence of a notransform directive proxies should add the ip address of the initiator of the request to the end of a comma separated list in an xforwardedfor http header field proxies must in accordance with rfc  include a via http header field see  proxy treatment of via header field  proxy treatment of via header field proxies should indicate their ability to transform content by including a comment in the via http header field consisting of the uri httpwwwworgnsct when forwarding via header fields proxies should not alter them by removing comments from them note according to rfc  http section  via header field comments may be removed by any recipient prior to forwarding the message however the justification for removing such comments is based on memory limitations of early proxies most modern proxies do not suffer such limitations  proxy forwarding of response to user agent in the following proxies must check for the presence of equivalent meta httpequiv elements in html content if the relevant http header field is not present  user preferences proxies must provide a means for users to express preferences for inhibiting content transformation even when content transformation has been chosen by the user as the default behavior those preferences must be maintained on a user by user and web site by web site basis proxies must solicit reexpression of preferences in respect of a server if the server starts to indicate that it offers varying responses as discussed under  receipt of vary http header field  receipt of cachecontrol notransform if the response includes a cachecontrol notransform directive then proxies must not alter it other than to comply with transparent http behavior as described in rfc  http section  and section   use of cachecontrol notransform proxies may use cachecontrol notransform to inhibit transformation by further proxies  server rejection of http request proxies may treat responses with an http  status as though they were responses with an http  status if it has determined that the content eg your browser is not supported is equivalent to a response with an http  status  receipt of vary http header field a proxy may not be carrying out content tasting as described under  avoiding request unacceptable responses if it anticipates receiving a request unacceptable response however if it makes a request with altered header fields in these circumstances and receives a response containing a vary header field referring to one of the altered header fields then it should request the resource again with unaltered header fields it should also update whatever heuristics it uses so that unaltered header fields are presented first in subsequent requests for this resource  link to handheld representation if the response is an html response and it contains a link relalternate mediahandheld  element and the user agent is determined as being handheld a proxy should request and process the referenced resource unless the resource referenced is the current representation note in this document the term current representation means a same document reference as defined in rfc  section  with the addition that if a vary http header field was present on the response then it is the same representation if the values of the http header fields of the request have not been altered  wml content if the content is wml proxies should act in a transparent manner note this does not affect the operation of proxies that are also wap gateways  proxy decision to transform in the absence of a vary or notransform directive or a meta httpequiv element containing cachecontrol notransform proxies should not transform content matching any of the following rules unless the user has specifically requested transformation the content is html and contains link relalternate mediahandheld with a reference to the current representation the doctype of the content if it has one indicates xhtmlmp xhtml basic wml or imode as listed in e doctypes associated with mobile content the contenttype has a value listed in c internet content types associated with mobile content the uri of the response following redirection or as indicated by the contentlocation http header field matches a pattern listed in f uri patterns associated with mobile web sites the response contains a resource that is referenced as an included resource suitable for handheld in a resource that was itself handled transparently the contenttype indicates that the content is data  some values are listed in d internet content types associated with data content a claim of mobileok basic mobileok basic tests conformance is indicated see mobileok scheme for how such a claim may be indicated other factors that a proxy may take into account the web site see note has previously shown that it is contextually aware even if the present response does not indicate this the user agent has features such as linearization or zoom or is a desktop device using a mobile network for access that allow it to present the content unaltered the response contains client side scripts that may misoperate if the resource is restructured the response is an html response and it includes link elements specifying alternatives according to presentation media type  alteration of response note other than as noted in this section the nature of restructuring that is carried out any character encoding alterations and what is omitted and what is inserted is as discussed in  scope out of scope of this document if a proxy alters the response then it must add a warning  transformation applied http header field the altered content should validate according to an appropriate published formal grammar and if xml must be wellformed it should indicate to the user that the content has been transformed for mobile presentation and provide an option to view the original unmodified content  link rewriting note in this document two uris have the sameorigin if the scheme component and the host and port subcomponents as defined in rfc  all match section  of rfc  discusses uri comparison some proxy deployments have to rewrite links in content in order for the user agent to request the referenced resources through the proxy in so doing proxies make unrelated resources appear as though they have the sameorigin and hence there is a danger of introducing security vulnerabilities note this section on link rewriting refers also to insertion of links frame flattening and any other techniques that introduces the sameorigin issue note link rewriting is always used by ct proxies that are accessed as an origin server initially eg which provide mobile adapted web search and navigation to the web pages returned in the search results or to which the browser is redirected through the ct proxy for adaptation of a web page link rewriting may be used by ct proxies acting as normal http proxies eg configured or transparent for the browser but may not be required since all browser requests flow through the ct proxy proxies must not rewrite links when content transformation is prohibited proxies must preserve security between requests for domains that are not sameorigin in respect of cookies and scripts  https link rewriting note for clarity it is emphasized that it is not possible for a transforming proxy to transform content accessed via an https link without breaking endtoend security interception of https and the circumstances in which it might be permissible is not a mobile question as such but is highly pertinent to this document the bpwg is aware that interception of https happens in many networks today interception of https is inherently problematic and may be unsafe the bpwg would like to refer to protocol based two party consent mechanisms but such mechanisms do not exist at the time of writing of this document the practice of intercepting https links is strongly not recommended if a proxy rewrites https links it must advise the user of the security implications of doing so and must provide the option to bypass it and to communicate with the server directly notwithstanding anything else in this document proxies must not rewrite https links in the presence of a cachecontrol notransform directive if a proxy rewrites https links replacement links must have the scheme https when forwarding requests originating from https links proxies must include a via header field as discussed under  proxy treatment of via header field when forwarding responses from servers proxies must notify the user of invalid server certificates  testing normative operators of content transformation proxies should make available an interface through which the functions of the proxy can be exercised the operations possible through this interface must cover those necessary to settle the outcome of all conformance statements listed in section b the interface must be reachable from terminals with browsing capabilities connected to the web via a conventional internet access environment at the testers premises accessing the interface may necessitate adjusting standard web browsing configuration parameters  such as specifying a proxy ip address and port on a desktop browser or activating a wap setting on a mobile browser such access must be granted under fair reasonable and nondiscriminatory conditions in particular it is available to all worldwide whether or not they are wc members it does not impose any further conditions or restrictions on the use of any technology intellectual property rights or other restrictions on behaviour of the tester but may include reasonable customary terms relating to operation or maintenance of the relationship between tester and proxy operator such as the following choice of law and dispute resolution confidentiality of parameters to access the interface disclaimer of liability a references ct landscape content transformation landscape  jo rabin andrew swainston eds wc working group note  october  see httpwwwworgtrnotectlandscape rfc  key words for use in rfcs to indicate requirement levels  request for comments  s bradner march  see httpwwwietforgrfcrfctxt rfc  http hypertext transfer protocol  http request for comments  r fielding j gettys j mogul h frystyk l masinter p leach t bernerslee june  see httptoolsietforghtmlrfc rfc  uniform resource identifier uri generic syntax request for comments  t bernerslee r fielding l masinter january  see httptoolsietforghtmlrfc rfc  opes iab architectural and policy considerations for open pluggable edge services request for comments  s floyd l daigle january  see httptoolsietforghtmlrfc device independence glossary wc glossary of terms for device independence rhys lewis ed wc working draft  january  best practices mobile web best practices  basic guidelines jo rabin charles mccathienevile eds wc recommendation  july  see httpwwwworgtrrecmobilebp mobileok basic tests wc mobileok basic tests  sean owen jo rabin eds wc recommendation  december  see httpwwwworgtrrecmobileokbasictests mobileok scheme wc mobileok scheme  jo rabin phil archer eds wc note  august  see httpwwwworgtrnotemobileok powder resource grouping protocol for web description resources powder grouping of resources phil archer andrea perego kevin smith eds wc recommendation  september  see httpwwwworgtrrecpowdergrouping xhr xmlhttprequest anne van kesteren ed wc candidate recommendation  august  see httpwwwworgtrcrxmlhttprequest xml extensible markup language xml  fifth edition t bray j paoli c sperbergmcqueen e maler f yergeau eds wc recommendation  november  see httpwwwworgtrrecxml b conformance statement see httpwwwworgtrnotectguidelinesics c internet content types associated with mobile content this list is not exhaustive and is likely to change applicationvndwapxhtmlxml textvndwapwml applicationvndwapwmlc textvndwapwmlxml textvndwapwmlscript applicationvndwapwmlscriptc imagevndwapwbmp applicationvndwapwbxml applicationvndwapmultipartmixed applicationvndwapmultipartrelated applicationvndwapmultipartalternative applicationvndwapmultipartformdata imagexupwpng imagexupbmp d internet content types associated with data content this list is not exhaustive and is likely to change applicationjson applicationsoapxml applicationsoapfastinfoset applicationfastsoap applicationfastinfoset e doctypes associated with mobile content this list is not exhaustive and is likely to change omadtd xhtml mobile en wapforumdtd xhtml mobile en wapforumdtd xhtml mobile en wcdtd xhtml basic en wcdtd xhtml basic en openwavedtd xhtml en openwavedtd xhtml mobile en imode group jadtd xhtml ixhtml localeverja en imode group jadtd xhtml ixhtml localeverja en imode group jadtd xhtml ixhtml localeverja en imode group jadtd xhtml ixhtml localeverja en imode group jadtd xhtml ixhtml localeverja en imode group jadtd xhtml ixhtml localeverja en wcdtd compact html  draften bbswdtd compact html en wapforumdtd wml en wapforumdtd wml en wapforumdtd wml en wapforumdtd wml en wapforumdtd wml en phonecomdtd wml en openwavecomdtd wml en f uri patterns associated with mobile web sites using the notation defined in powder resource grouping iriset        includehostsmobiincludehosts        iriset g summary of user preference handling user expression of preferences is referred to in several sections in this document those sections are  priority of intention  serving cached responses  user selection of restructured experience  user preferences  receipt of cachecontrol notransform  proxy decision to transform  alteration of response  https link rewriting user preferences are also referred to nonnormatively under i varying representations h example transformation interactions nonnormative note the following examples refer to requests with the get method h basic content tasting by proxy request resource with original header fields if the response is a  response if the response contains cachecontrol notransform forward it otherwise request again with altered header fields if the response is a  response if the response contains vary useragent an appropriate link element or header field or cachecontrol notransform forward it otherwise assess whether the  response is a form of request unacceptable if it is not forward it if it is request again with altered header fields h optimization based on previous server interaction proxy receives a request for resource p that it has not encountered before proxy forwards this request response is  ok containing the text unsupported browser please get a different one or use a ct proxy proxy determines that this equates to a  status and requests the resource from the origin server again with altered header fields emulating a well known desktop browser response is a desktop oriented representation of the resource proxy transforms this response into content that the user agent can display well and forwards it proxy receives a further request for the resource p based on evidence from the previous interaction eg that there was no vary header field that the response was not targeted at only the previous user in that there was no cachecontrol private directive the ct proxy forwards the request with altered header fields response is a desktop oriented representation of the resource proxy transforms this response into content that the user agent can display well and forwards it h optimization based on previous server interaction server has changed its operation proxy receives a request for resource p that it has previously encountered as in h optimization based on previous server interaction proxy forwards request with altered header fields response is  ok containing a vary useragent header field proxy notices that behavior has changed and reissues the request with original header fields response is  ok and proxy forwards it h server response indicating that this representation is intended for the target device proxy receives a request for resource p proxy forwards request with original header fields response is  ok with vary useragent and link typealternate mediahandheld hrefpid  where id is a document local reference proxy forwards response as designed specifically for the requesting device h server response indicating that another representation is intended for the target device proxy receives a request for resource p proxy forwards request with original header fields response is  ok with link typealternate mediahandheld hrefq  and q is not p proxy requests q with original header fields response is  ok and proxy forwards it i informative guidance for origin servers nonnormative content providers may wish to follow these procedures in order to improve interoperability i server response to proxy i use of http  status servers should consider using an http  status and not an http  status if a request cannot be satisfied with content that meets the criteria specified by values of the http request header fields however some browsers do not display the content of http  status responses i use of http  status servers should consider using an http  status if concerned that the security of a link assumed to be private has been compromised for example this may be inferred by the presence of a via http header field in an https request i server origination of cachecontrol notransform servers should consider including a cachecontrol notransform directive if one is received in the http request as it may be an indication that the client does not wish to receive a transformed response include a cachecontrol notransform directive if for any reason transformation of the response is prohibited note including a cachecontrol notransform directive can disrupt the behavior of wap gateways because it can inhibit such proxies from converting wml to wmlc including such a directive may also disrupt the behavior of a proxy based accessibility solution i varying representations it is good practice to take account of user agent capabilities and formulate an appropriate experience according to those capabilities it is good practice to provide a means for users to select among available representations to default to the last selected representation and to provide a means of changing the selection i use of vary http header field if a server varies its representation according to examination of received http header fields then rfc  http describes how to use the vary header field to indicate this servers that are aware of the presence of a transforming proxy as identified by a via http header field might alter their responses according to their knowledge of specific proxy behavior when doing so it is good practice to make sure that the internet content type for a response is correct for the actual content eg a server should not choose contenttype applicationvndwapxhtmlxml because it suspects that proxies will not transform content of this type if its content is not valid xhtmlmp i indication of intended presentation media type of representation if a server has distinct representations that vary according to the target presentation media type it can inhibit transformation of the response by including a cachecontrol notransform directive see i server origination of cachecontrol notransform in addition in html content it can indicate the medium for which the representation is intended by including a link element identifying in its media attribute the target presentation media types of this representation and setting the href attribute to samedocument reference see rfc  section  and in particular an empty href attribute is a same document reference in addition it is good practice to include link elements identifying the target presentation media types of other available representations in a similar manner if content for more than one presentation media type is served from the same uri it is better not to use a link element identifying the presentation media types as the uri will appear to be a same document reference indicating to a client that this representation is suitable for all the named presentation media types instead use a vary http header field indicating that the response varies according to the received useragent http header field note some examples of the use of the link element are included above in h example transformation interactions j applicability to transforming solutions which are out of scope nonnormative there are a number of wellknown examples of solutions that seem to their users as though they are using a browser but because the client software communicates using proprietary protocols and techniques it is the combination of the client and the network component that is regarded as the http user agent the communication between the client and the network component is therefore out of scope of this document additionally where some kind of administrative arrangement exists between a transforming proxy and an origin server for the purposes of transforming content on the origin servers behalf this is also out of scope of this document in both of the above cases it is good practice to adhere to the provisions of this document in respect of providing information about the device and the original ip address k scope for future work nonnormative k powder the bpwg believes that powder will represent a powerful mechanism by which a server may express transformation preferences future work in this area may recommend the use of powder to provide a mechanism for origin servers to indicate more precisely which alternatives they have and what transformation they are willing to allow on them and in addition to provide for content transformation proxies to indicate which services they are able to perform k link http header field the bpwg believes that the link http header field which was removed from http and which is under discussion for reintroduction would represent a more general and flexible mechanism than use of the html link element as discussed in this recommendation k sources of device information the process of adapting content at the origin server or transforming it in a proxy is likely to have a dependency on a repository of device descriptions an origin servers willingness to allow a transforming proxy to transform content may depend on its evaluation of the trustworthiness of device description data that is being used there is scope for enhancement of the trust relationship by some means of indicating this k inter proxy communication there is scope for further work to define how multiple proxies may interoperate a common case of multiple proxies is where a network provider transforming proxy and a search engine transforming proxy are both present k explicit consent robust mechanisms are needed for indicating consent to or prohibition of transformation operations of various kinds especially https link rewriting see  https link rewriting k amendment to and refinement of http the bpwg believes that amendments to http are needed to improve the interoperability of transforming proxies for example http does not provide a way to distinguish between prohibition of any kind of transformation and the prohibition only of restructuring and not recoding or compression at present http does not provide a mechanism for communicating original header field values the scheme based on xdevice prefixed fields described under  alteration of http header field values records and clarifies an approach used to achieve this effect by some content transformation proxies this scheme relies upon nonstandard http header fields which have been provisionally registered with iana while the mechanism defined in that section based on current practice applies to conforming transformation proxy deployments it is possible that in future in collaboration with the ietf this approach will be reconsidered this implies that the specified xdevice prefixed fields may at some time become deprecated in favor of new equivalent fields or that an entirely different approach will be taken to representing such values a number of mechanisms exist in http which might be exploited given more precise definition of their operation  for example the options method and the http  multiple choices status l acknowledgments nonnormative the editor acknowledges contributions of various kinds from members of the mobile web best practices working group and earlier from the content transformation task force of that group the editor acknowledges significant written contributions from franois daoust task force leader wc magnus lnnroth ericsson and previously at drutt bryan sullivan att sean patterson novarra aaron kemp google rob finean openwave heiko gerlach vodafone martin jones volantis tom hume wc invited expert eduardo casais wc invited expert